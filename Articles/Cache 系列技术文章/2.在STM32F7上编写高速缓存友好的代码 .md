# 在 STM32F7 上编写对高速缓存友好的代码

本系列文章的第二篇原想命名为《STM32F7 Cache 介绍与实战》，其中会讲解一些在 STM32F7 上如何使用 cache 的内容，但是后来发现已经有相当多的文章介绍如何配置 MPU 与 cache 了。因此本文不再进行详细描述对 MPU 以及  cache 的配置过程，而是推荐大家去阅读这些质量较高的文章。

本文想要讲述的内容如下：

1. 如何写出对高速缓存友好的代码？
2. 这背后的原理是什么？

## 关于程序的局部性

一个编写良好的计算机程序常常具有良好的**局部性**。也就是说，这些程序倾向于访问最近引用过的数据项周边的数据项，或者最近引用过的数据项本身。这种倾向性，被称为**局部性原理（principle of locality）**。这个概念在计算机系统中使用得非常广泛，对硬件和软件系统的设计和性能都有着极大的影响。

在上一篇文章中，简要介绍了局部性的两种形式：

- 时间局部性

  在一个具有良好时间局部性的程序中，被引用过一次的内存位置很可能在不远的将来再被多次引用。

- 空间局部性

  在一个具有良好空间局部性的程序中，如果一个内存位置被引用了一次，那么程序很可能在不远的将来引用附近的一个内存位置。

这是一个非常重要的概念，因为在计算机系统的各个层次，从硬件到操作系统、再到应用程序，他们都利用了局部性，下面举几个简单的例子：

1. 在 CPU 中，设计者通过引入高速缓存（Cache）来保存最近被引用的指令和数据。
2. 在操作系统中，局部性原理允许系统使用主存（DRAM）作为虚拟地址空间最近被引用块的缓存。
3. Web 浏览器将最近被引用的文档放在本地磁盘上。
4. 当你玩游戏进入一张新的地图时，整张地图被加载到内存中作为缓存，这样你就可以到处玩耍了。

### 数据引用的局部性

### 取指令的局部性

## 关于缓存


## 如何编写高速缓存（Cache）友好的代码

